html
<!DOCTYPE html>
<html lang="es">

<head>
<meta charset="UTF-8">
<title>Chat con Gemini</title>
<style>
body {
font-family: Arial;
background: #f0f0f0;
padding: 20px;
}

#chat {
background: white;
padding: 10px;
border-radius: 10px;
height: 400px;
overflow-y: auto;
}

.msg-user {
color: blue;
margin: 5px 0;
}

.msg-ai {
color: green;
margin: 5px 0;
}

#inputBox {
width: 60%;
padding: 10px;
}

#btn {
padding: 10px 15px;
}

#btnAuto,
#btnManual {
padding: 10px 15px;
margin-left: 5px;
}

.active {
background-color: #4CAF50;
color: white;
}
</style>
</head>

<body>
<h2>üí¨ Chat con Gemini (HTML/JS)</h2>
<div id="chat"></div>

<br>
<input id="inputBox" type="text" placeholder="Escribe aqu√≠...">
<button id="btn">Enviar</button>
<button id="btnAuto">Auto</button>
<button id="btnManual">Manual</button>

<script>
const API_KEY = "AIzaSyD_gB4MPg6-75QjuYRIKDEvaFIcMw7-uZ8"; // <-- pon tu nueva API key
const MODEL = "gemini-2.0-flash";
const URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`;

let history = []; // memoria del chat
let autoMode = false;

document.getElementById("btn").onclick = sendMessage;
document.getElementById("inputBox").addEventListener("keydown", e => {
if (e.key === "Enter") sendMessage();
});

// Auto mode button functionality
const btnAuto = document.getElementById("btnAuto");
btnAuto.addEventListener("click", () => {
autoMode = !autoMode;
btnAuto.classList.toggle("active", autoMode);
if (autoMode) {
startSpeechRecognition();
} else {
stopSpeechRecognition();
}
});

// Manual mode button functionality
document.getElementById("btnManual").onclick = () => {
const lastMessage = document.querySelector("#chat > div:last-child.msg-ai");
if (lastMessage) {
speak(lastMessage.innerText.replace("Gemini: ", ""));
}
};

function addMessage(text, cls) {
const chat = document.getElementById("chat");
const div = document.createElement("div");
div.className = cls;
div.innerText = text;
chat.appendChild(div);
chat.scrollTop = chat.scrollHeight;

if (cls === "msg-ai" && autoMode) {
speak(text.replace("Gemini: ", ""));
}
}

async function sendMessage() {
const userText = document.getElementById("inputBox").value.trim();
if (userText === "") return;

addMessage("T√∫: " + userText, "msg-user");
document.getElementById("inputBox").value = "";

history.push({
role: "user",
parts: [{
text: userText
}]
});

try {
const body = {
contents: history
};

const response = await fetch(URL, {
method: "POST",
headers: {
"Content-Type": "application/json"
},
body: JSON.stringify(body)
});

const data = await response.json();
const output = data.candidates[0].content.parts[0].text;

addMessage("Gemini: " + output, "msg-ai");
history.push({
role: "model",
parts: [{
text: output
}]
});

} catch (error) {
addMessage("‚ö†Ô∏è Error: " + error, "msg-ai");
}
}

// Text-to-Speech Function
function speak(text) {
const utterance = new SpeechSynthesisUtterance(text);
utterance.lang = 'es-ES'; // Set the language to Spanish
window.speechSynthesis.speak(utterance);
}


// Speech Recognition Functionality
let recognition;

function startSpeechRecognition() {
if ('webkitSpeechRecognition' in window) {
recognition = new webkitSpeechRecognition();
recognition.lang = 'es-ES'; // set the language
recognition.continuous = true;
recognition.interimResults = false;

recognition.onstart = function () {
console.log("Speech recognition started.");
};

recognition.onresult = function (event) {
const transcript = event.results[event.results.length - 1][0].transcript;
document.getElementById("inputBox").value = transcript;
sendMessage();
};

recognition.onerror = function (event) {
console.error("Speech recognition error:", event.error);
};

recognition.onend = function () {
console.log("Speech recognition ended.");
if (autoMode) {
startSpeechRecognition(); // Restart if in auto mode
}
};

recognition.start();
} else {
alert("Speech recognition is not supported in this browser.");
}
}

function stopSpeechRecognition() {
if (recognition) {
recognition.stop();
console.log("Speech recognition stopped.");
}
}
</script>

</body>

</html>
