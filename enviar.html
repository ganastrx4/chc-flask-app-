<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pagar con WLD</title>
  <!-- 📌 Carga ethers.js UMD -->
  <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
</head>
<body>

  <h1>Enviar 0.1 WLD</h1>
  <input id="addressInput" type="text" placeholder="Dirección 0x..." size="42">
  <button onclick="enviarPago()">Enviar Pago</button>

  <script>
    const contractAddress = "0x2cfc85d8e48f8eab294be644d9e25c3030863003";
    const abi = [
      "function transfer(address to, uint amount) public returns (bool)"
    ];

    async function enviarPago() {
      const to = document.getElementById("addressInput").value.trim();
      if (!/^0x[a-fA-F0-9]{40}$/.test(to)) {
        alert("Dirección no válida.");
        return;
      }

      if (window.ethereum || window.worldcoin) {
        const provider = new ethers.providers.Web3Provider(
          window.worldcoin || window.ethereum
        );
        await provider.send("eth_requestAccounts", []);
        const signer = provider.getSigner();

        const contract = new ethers.Contract(contractAddress, abi, signer);

        try {
          const tx = await contract.transfer(to, ethers.utils.parseUnits("0.1", 18));
          alert("Transacción enviada:\n" + tx.hash);
        } catch (err) {
          console.error(err);
          alert("Error al enviar WLD.");
        }
      } else {
        alert("No se detectó World App ni Metamask.");
      }
    }
  </script>

</body>
</html>
