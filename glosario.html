html
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Trading Bot EMA/ADX (HTML/JS)</title>
<style>
body { font-family: Arial; background:#f4f4f4; padding:20px; }
#log { background:white; padding:15px; border-radius:10px; height:400px; overflow-y:auto; }
input { padding:10px; width:200px; }
button { padding:10px 15px; }
#parameters { display: flex; flex-direction: column; margin-bottom: 10px; }
#parameters label { margin-bottom: 5px; }
#parameters input[type="number"] { width: 100px; padding: 5px; }
#current-analysis { font-weight: bold; margin-bottom: 10px; } /* Estilo para el an√°lisis actual */
</style>
</head>

<body>

<h2>üìä Estrategia EMA50 (1m) + EMA20 (5m) + ADX(5m)</h2>

<input id="symbol" placeholder="BTCUSDT">
<button onclick="startBot()">Iniciar</button>

<div id="parameters">
<label for="stopLossPct">Stop Loss (%)</label>
<input type="number" id="stopLossPct" value="2" step="0.1">

<label for="takeProfitPct">Take Profit (%)</label>
<input type="number" id="takeProfitPct" value="4" step="0.1">

<label for="minAdx">ADX M√≠nimo</label>
<input type="number" id="minAdx" value="20" step="1">

<label for="confirmationCandles">Velas de confirmaci√≥n</label>
<input type="number" id="confirmationCandles" value="3" step="1">

<label for="positionSize">Tama√±o de la Posici√≥n (USDT)</label>
<input type="number" id="positionSize" value="0.06" step="0.01">

<label for="leverage">Apalancamiento (X)</label>
<input type="number" id="leverage" value="100" step="1">
</div>

<div id="current-analysis"></div> <!-- Elemento para mostrar el an√°lisis actual -->
<div id="log"></div>

<script>
// ==================================================
// LOG EN PANTALLA (SOBRESCRIBE EL AN√ÅLISIS)
// ==================================================
function log(text) {
const box = document.getElementById("log");
box.innerHTML += text + "<br>";
box.scrollTop = box.scrollHeight;
}

function updateAnalysis(text) {
const analysisDiv = document.getElementById("current-analysis");
analysisDiv.textContent = text;
}

// ==================================================
// DESCARGA DE VELAS BINANCE
// ==================================================
async function getKlines(symbol, interval, limit=200) {
const url = `https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`;
const r = await fetch(url);
const data = await r.json();

return data.map(k => ({
time: k[0],
open: parseFloat(k[1]),
high: parseFloat(k[2]),
low: parseFloat(k[3]),
close: parseFloat(k[4])
}));
}

// ==================================================
// EMA
// ==================================================
function ema(values, length) {
let k = 2 / (length + 1);
let emaArray = [];
let emaPrev = values[0];

for (let i = 0; i < values.length; i++) {
emaPrev = values[i] * k + emaPrev * (1 - k);
emaArray.push(emaPrev);
}
return emaArray;
}

// ==================================================
// ADX
// ==================================================
function calcADX(candles, length=14) {
let plusDM = [];
let minusDM = [];
let TR = [];

for (let i = 1; i < candles.length; i++) {
let high = candles[i].high;
let low = candles[i].low;
let prevHigh = candles[i-1].high;
let prevLow = candles[i-1].low;
let prevClose = candles[i-1].close;

let upMove = high - prevHigh;
let downMove = prevLow - low;

plusDM.push(upMove > downMove && upMove > 0 ? upMove : 0);
minusDM.push(downMove > upMove && downMove > 0 ? downMove : 0);

let tr = Math.max(
high - low,
Math.abs(high - prevClose),
Math.abs(low - prevClose),
Math.abs(low - prevClose)
);
TR.push(tr);
}

function rma(values, length) {
let r = [];
let sum = values.slice(0, length).reduce((a,b) => a+b);
r[length-1] = sum / length;

for (let i = length; i < values.length; i++) {
r[i] = (r[i-1] * (length - 1) + values[i]) / length;
}
return r;
}

let ATR = rma(TR, length);
let PDI = rma(plusDM, length).map((v,i)=>100*(v/ATR[i]));
let MDI = rma(minusDM, length).map((v,i)=>100*(v/ATR[i]));
let DX = PDI.map((v,i)=>100*Math.abs((v - MDI[i]) / (v + MDI[i])));

let ADX = rma(DX, length);
return ADX[ADX.length - 1]; // √∫ltimo valor
}

// ==================================================
// CONFIRMACI√ìN ADICIONAL (Velas de Confirmaci√≥n)
// ==================================================
function confirmarSenal(df1m, signal, confirmationCandles) {
if (signal === "üìà ENTRADA EN COMPRA") {
for (let i = df1m.length - 1; i > df1m.length - 1 - confirmationCandles; i--) {
if (df1m[i].close <= df1m[i].open) {
return false;
}
}
return true;
} else if (signal === "üìâ ENTRADA EN VENTA") {
for (let i = df1m.length - 1; i > df1m.length - 1 - confirmationCandles; i--) {
if (df1m[i].close >= df1m[i].open) {
return false;
}
}
return true;
}
return false;
}

// ==================================================
// GENERAR SE√ëAL
// ==================================================
function generarSenal(df1m, df5m, minAdx, confirmationCandles) {
let closes1m = df1m.map(c=>c.close);
let closes5m = df5m.map(c=>c.close);

let ema50_arr = ema(closes1m, 50);
let ema20_arr = ema(closes5m, 20);

let ema50 = ema50_arr[ema50_arr.length - 1];
let ema20 = ema20_arr[ema20_arr.length - 1];
let ema20_prev = ema20_arr[ema20_arr.length - 2];

let adx5m = calcADX(df5m);

let precio = df1m[df1m.length - 1].close;

let analysisText = `Precio: ${precio.toFixed(5)} | EMA50: ${ema50.toFixed(5)} | EMA20: ${ema20.toFixed(5)} | ADX: ${adx5m.toFixed(2)}`;

updateAnalysis(analysisText);

if (precio > ema50 && ema20 > ema20_prev && adx5m > minAdx) {
let senal = "üìà ENTRADA EN COMPRA";
if (confirmarSenal(df1m, senal, confirmationCandles)) return senal + " (CONFIRMADA)";
else return "‚è≥ Esperando confirmaci√≥n compra...";
}

if (precio < ema50 && ema20 < ema20_prev && adx5m > minAdx){
let senal = "üìâ ENTRADA EN VENTA";
if (confirmarSenal(df1m, senal, confirmationCandles)) return senal + " (CONFIRMADA)";
else return "‚è≥ Esperando confirmaci√≥n venta...";
}

return "‚è≥ Esperando se√±al‚Ä¶";
}

// ==================================================
// SIMULACI√ìN DE GESTI√ìN DE RIESGO Y PNL
// ==================================================
async function ejecutarOrden(symbol, side, price, stopLossPct, takeProfitPct, positionSize, leverage) {
const stopLoss = side === "BUY" ? price * (1 - stopLossPct/100) : price * (1 + stopLossPct/100);
const takeProfit = side === "BUY" ? price * (1 + takeProfitPct/100) : price * (1 - takeProfitPct/100);

let pnl;
let tradeResult;

if (side === "BUY") {
// Simulando que el precio alcanza el take profit
pnl = (takeProfit - price) * (positionSize * leverage / price);
tradeResult = `COMPRA a ${price.toFixed(5)}, TP a ${takeProfit.toFixed(5)}, SL a ${stopLoss.toFixed(5)}. PNL = ${pnl.toFixed(5)} USDT`;
} else {
// Simulando que el precio alcanza el take profit
pnl = (price - takeProfit) * (positionSize * leverage / price);
tradeResult = `VENTA a ${price.toFixed(5)}, TP a ${takeProfit.toFixed(5)}, SL a ${stopLoss.toFixed(5)}. PNL = ${pnl.toFixed(5)} USDT`;
}

// Simulaci√≥n de comisiones (ejemplo: 0.1% por orden)
const comision = positionSize * 0.001; // 0.1% de la posici√≥n
pnl -= comision;
tradeResult += ` (Comisi√≥n: ${comision.toFixed(5)} USDT, PNL Neto: ${pnl.toFixed(5)} USDT)`;


log(`Simulando orden ${side} para ${symbol} a ${price.toFixed(5)}. ${tradeResult}`);
}

// ==================================================
// LOOP PRINCIPAL
// ==================================================
let running = false;

async function startBot() {
if (running) return;
running = true;

const symbol = document.getElementById("symbol").value.toUpperCase();
const stopLossPct = parseFloat(document.getElementById("stopLossPct").value);
const takeProfitPct = parseFloat(document.getElementById("takeProfitPct").value);
const minAdx = parseFloat(document.getElementById("minAdx").value);
const confirmationCandles = parseInt(document.getElementById("confirmationCandles").value);
const positionSize = parseFloat(document.getElementById("positionSize").value);
const leverage = parseInt(document.getElementById("leverage").value);

log("=== BOT INICIADO PARA " + symbol + " ===");
log(`SL: ${stopLossPct}%, TP: ${takeProfitPct}%, Min ADX: ${minAdx}, Velas Confirmaci√≥n: ${confirmationCandles}, Posici√≥n: ${positionSize} USDT, Apalancamiento: ${leverage}x`);

let inTrade = false;

while (running) {
try {
let df1m = await getKlines(symbol, "1m");
let df5m = await getKlines(symbol, "5m");

let senal = generarSenal(df1m, df5m, minAdx, confirmationCandles);

if (senal.includes("COMPRA (CONFIRMADA)") && !inTrade) {
let precioEntrada = df1m[df1m.length - 1].close;
ejecutarOrden(symbol, "BUY", precioEntrada, stopLossPct, takeProfitPct, positionSize, leverage);
inTrade = true; // Marcamos que estamos en operaci√≥n

} else if (senal.includes("VENTA (CONFIRMADA)") && !inTrade) {
let precioEntrada = df1m[df1m.length - 1].close;
ejecutarOrden(symbol, "SELL", precioEntrada, stopLossPct, takeProfitPct, positionSize, leverage);
inTrade = true; // Marcamos que estamos en operaci√≥n
}


log("‚Üí Se√±al: " + senal);

// Simulaci√≥n de salida (temporal - para testear)
if(inTrade) {
setTimeout(() => {
inTrade = false; //Fuerza la salida tras X segundos.
log("Operaci√≥n cerrada (simulaci√≥n).");
}, 5000);
}


} catch (e) {
log("‚ùå Error: " + e);
}

await new Promise(r => setTimeout(r, 2000));
}
}
</script>

</body>
</html>
